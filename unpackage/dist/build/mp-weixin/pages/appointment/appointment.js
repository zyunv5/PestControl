(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/appointment/appointment"],{"0d4c":function(t,e,a){"use strict";var n=a("9b4e"),i=a.n(n);i.a},"41e0":function(t,e,a){"use strict";a.r(e);var n=a("5335"),i=a.n(n);for(var s in n)"default"!==s&&function(t){a.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},5335:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a("1495")),i=s(a("1831"));function s(t){return t&&t.__esModule?t:{default:t}}var o={data:function(){for(var t=new Date,e=[],a=t.getFullYear(),n=a;n<=t.getFullYear()+10;n++)e.push(n);return{year:a,years:e,month:null,months:[],day:null,days:[],dayTime:[{noon:"上午",time:"09:00",active:!1,isFull:!1},{noon:"上午",time:"11:00",active:!1,isFull:!1},{noon:"下午",time:"13:00",active:!1,isFull:!1},{noon:"下午",time:"15:00",active:!1,isFull:!1},{noon:"下午",time:"17:00",active:!1,isFull:!1},{noon:"下午",time:"19:00",active:!1,isFull:!1},{noon:"下午",time:"21:00",active:!1,isFull:!1}],area:"选择您所在区域",bgMap:["东城区","西城区","朝阳区","海淀区","丰台区","石景山区","通州区","昌平区"],areaColor:!1,user:"",phone:"",address:"",id:"",isLogin:!0}},computed:{detail:function(){var t=this.$store.state.detail;return t}},onShow:function(){var e=wx.getStorageSync("token");e||t.showToast({title:"请先登录再进行预约",icon:"none",duration:3e3}),this.setCurrentTime();var a=(0,i.default)().add(1,"day");if(this.getNextDay(a),"{}"!==JSON.stringify(this.detail)){var n=JSON.parse(this.detail),s=(0,i.default)(n.time);this.year=s.year(),this.month=s.month(),this.day=s.date()-1,this.dayTime.filter((function(t){t.time==="".concat(s.hour(),":00")&&(t.active=!0)})),this.id=n.id,this.areaColor=!0,this.user=n.name,this.phone=n.phone,this.address=n.address,this.area=n.area}},methods:{yearChange:function(t,e){this.year=e?this.year+1:this.years[t.target.value];var a=e?this.year+1:this.years[t.target.value],n=(0,i.default)("".concat(a,"-").concat(this.month+1)).daysInMonth();this.dayOrigin(n,this.month+1);var s=(0,i.default)("".concat(this.year,"-").concat(this.month+1,"-").concat(this.day+1));""!==t&&this.getNextDay(s)},monthChange:function(t,e){this.month=e?e-1:this.months[t.target.value]-1;var a=e||this.months[t.target.value],n=(0,i.default)("".concat(this.year,"-").concat(a)).daysInMonth();this.dayOrigin(n,a);var s=(0,i.default)("".concat(this.year,"-").concat(this.month+1,"-").concat(this.day+1));""!==t&&this.getNextDay(s)},dayOrigin:function(t,e){var a=this.day,n=(this.days,[]),s=(0,i.default)().month()+1,o=(0,i.default)().date(),r=(0,i.default)().daysInMonth();if(console.log(a,o,r),e===s){for(var c=o;c<=r;c++)n.push(c);a<o&&(this.day=o-1),this.days=n}else{for(var h=1;h<=t;h++)n.push(h);this.days=n,"30"==a&&(this.day=this.days[this.days.length-1]-1)}},dayChange:function(t,e){this.day=e?e-1:this.days[t.target.value]-1;var a=(0,i.default)("".concat(this.year,"-").concat(this.month+1,"-").concat(this.day+1));""!==t&&this.getNextDay(a)},areaChange:function(t){this.area=this.bgMap[t.detail.value],this.areaColor=!0},changeTime:function(e){e.isFull?t.showToast({title:"该时间段已约满，请更换其他时间",icon:"none"}):(this.dayTime.forEach((function(t){return t.active=!1})),e.active=!0)},nextDay:function(){var t=this.year,e=this.month,a=this.day,n=(0,i.default)("".concat(t,"-").concat(e+1,"-").concat(a+1)).add(1,"day"),s=(n.year(),n.month()+1),o=n.date();this.getNextDay(n),e+1==12&&30==a&&this.yearChange("",1),this.monthChange("",s),this.dayChange("",o)},getNextDay:function(e){var a=this;t.request({url:n.default+"getTime",method:"GET",data:{time:e.format("YYYY-MM-DD")},header:{"content-type":"application/json"},success:function(t){for(var e=0;e<7;e++)t.data.data[e]>1&&(a.dayTime[e].isFull=!0),a.dayTime[e].active=!1}})},submitForm:function(){var e=this.dayTime.filter((function(t){return t.active})),a=this.month+1<10?"0"+(this.month+1):this.month+1,i=this.day+1<10?"0"+(this.day+1):this.day+1;if(this.user)if(/^1[3|4|5|6|7|8|9]\d{9}$/.test(this.phone))if("选择您所在区域"===this.area)this.alert("","请选择您所在区域");else if(this.address)if(0===e.length)this.alert("","请选择日期");else if(this.checkTime(this.year,a,i,e[0].time))this.alert("","所选日期早于当前日期");else{var s={user:this.user,phone:this.phone,area:this.area,address:this.address,time:"".concat(this.year,"-").concat(a,"-").concat(i," ").concat(e[0].time,":00")},o=wx.getStorageSync("token"),r=wx.getStorageSync("userName");o?(t.showLoading(),this.id?(s.id=this.id,t.request({url:n.default+"update",method:"POST",header:{"content-type":"application/json"},data:{token:o,username:r,form:s},dataType:"json",success:function(e){1===e.data.status?(t.hideLoading(),t.navigateTo({url:"../order/order"})):t.showToast({title:"提交失败，请检查网络环境",icon:"none"})}})):t.request({url:n.default+"submit",method:"POST",header:{"content-type":"application/json"},data:{token:o,username:r,form:s},dataType:"json",success:function(e){1===e.data.status?(t.hideLoading(),t.navigateTo({url:"../order/order"})):t.showToast({title:"提交失败，请检查网络环境",icon:"none"})}})):t.showToast({title:"请先登录再进行预约",icon:"none",duration:1500})}else this.alert("","请填写您的详细地址");else this.alert("","请填写正确的手机号");else this.alert("","请填写用户姓名")},alert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;t.showModal({title:e,content:a,showCancel:!!i,success:function(t){t.confirm&&n&&n(),t.cancel&&i&&i()}})},checkTime:function(t,e,a,n){var i=new Date("".concat(t,"-").concat(e,"-").concat(a," ").concat(n,":00")),s=new Date;return i.getTime()<s.getTime()},resetForm:function(){this.user="",this.phone="",this.area="选择您所在区域",this.areaColor=!1,this.address="";var t=new Date;this.year=t.getFullYear(),this.dayTime.forEach((function(t){return t.active=!1})),this.setCurrentTime()},getUserInfo:function(){var e=this;wx.getUserInfo({success:function(a){var i=a.userInfo;e.userName=i.nickName,e.userAvatar=i.avatarUrl,wx.setStorageSync("userName",i.nickName),wx.setStorageSync("userAvatar",i.avatarUrl),wx.login({success:function(a){a.code?t.request({url:n.default+"getOpenId",method:"POST",data:{code:a.code,name:i.nickName},success:function(t){wx.setStorageSync("token",t.data.sig),e.isLogin=!1}}):console.log("登录失败！"+a.errMsg)}})},fail:function(t){console.log("用户未授权")}})},setCurrentTime:function(){for(var t=(0,i.default)(),e=t.date(),a=t.daysInMonth(),n=[],s=t.month(),o=[],r=e;r<=a;r++)n.push(r);for(var c=s+1;c<=12;c++)o.push(c);this.day=e-1,this.days=n,this.month=s,this.months=o},onHide:function(){this.$store.dispatch("clearDetail"),this.resetForm()}}};e.default=o}).call(this,a("543d")["default"])},"7ffd":function(t,e,a){"use strict";a.r(e);var n=a("dd7a"),i=a("41e0");for(var s in i)"default"!==s&&function(t){a.d(e,t,(function(){return i[t]}))}(s);a("0d4c");var o,r=a("f0c5"),c=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);e["default"]=c.exports},"9b4e":function(t,e,a){},dd7a:function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return n}));var i=function(){var t=this,e=t.$createElement;t._self._c},s=[]},e853:function(t,e,a){"use strict";(function(t){a("6895"),a("921b");n(a("66fd"));var e=n(a("7ffd"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])}},[["e853","common/runtime","common/vendor"]]]);